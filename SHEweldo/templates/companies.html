<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Submission Form</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/salary-form.css') }}">
</head>
<body>
    <header class="menubar font-thin">
        <img src="{{ url_for('static', filename='images/SHEweldo.png') }}" alt="SHEweldo Logo" class="small-logo" />
        <div class="menubar-button-wrapper">
          <a href="index.html" target="_blank"><button class="menubar-btn">
            <span class="material-symbols-outlined"> Home </span>
          </button></a>
          <a href="/graph/companies/" target="_blank"><button class="menubar-btn">
            <span class="material-symbols-outlined"> View Companies </span>
          </button></a>
          <a href="/salaries/submit" target="_blank"><button class="menubar-btn">
            <span class="material-symbols-outlined"> Add Salary Data </span>
          </button></a>
        </div>
    </header>
    <br>
    <div class="formCompany">
        <h2>Company Submission Form</h2>
        <form id="companyForm">
            <br>
            <div class="row">
                <input type="text" id="company_name" name="company_name" placeholder="Company Name" required><br>
                <input type="number" id="company_size" name="company_size" placeholder="Company Size" required><br>
            </div>
            <div class="row">
                <input type="text" id="company_industry" name="company_industry" placeholder="Industry" required><br>
                <input type="text" id="country" name="country" placeholder="Country" required><br>
            </div>
            <button type="submit">Submit</button>
        </form>
    </div>
    <div id="message" style="display: none; padding: 10px; margin-top: 20px; border-radius: 5px;"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(() => {
                document.querySelector(".formCompany").classList.add("show");
            }, 100);
        });
        
        document.getElementById("companyForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const formData = {
        company_name: document.getElementById("company_name").value,
        company_size: parseInt(document.getElementById("company_size").value),
        company_industry: document.getElementById("company_industry").value,
        country: document.getElementById("country").value
    };
    
    try {
        const response = await fetch("/api/companies/add", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        const messageDiv = document.getElementById("message");
        
        if (response.ok) {
            messageDiv.style.display = "block";
            messageDiv.style.backgroundColor = "#d4edda";
            messageDiv.style.color = "#155724";
            messageDiv.textContent = "Company added successfully!";
            document.getElementById("companyForm").reset();
            
            // Open a new tab to /salaries/submit
            setTimeout(() => {
                window.open("/salaries/submit", "_blank");
            }, 1000);
        } else {
            messageDiv.style.display = "block";
            messageDiv.style.backgroundColor = "#f8d7da";
            messageDiv.style.color = "#721c24";
            messageDiv.textContent = result.error || "Error submitting company data";
        }
        
        setTimeout(() => {
            messageDiv.style.display = "none";
        }, 5000);
        
    } catch (error) {
        console.error("Error:", error);
        const messageDiv = document.getElementById("message");
        messageDiv.style.display = "block";
        messageDiv.style.backgroundColor = "#f8d7da";
        messageDiv.style.color = "#721c24";
        messageDiv.textContent = "Network error - please try again later.";
    }
});

    </script>
</body>
</html>